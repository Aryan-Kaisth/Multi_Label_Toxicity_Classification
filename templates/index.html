<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multi-Label Toxicity Classification</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">
</head>

<body>
  <main class="page">

    <header class="project-title glass">
      <h1>Multi-Label Toxicity Classification</h1>
      <p class="subtitle">Enter text below to analyze toxicity across multiple categories.</p>
    </header>

    <section class="layout">

      <!-- Input Section -->
      <form class="card glass input-card" onsubmit="event.preventDefault(); analyzeText();">

        <textarea id="userText"
          placeholder="Type or paste text here..."
          maxlength="10000"></textarea>

        <div class="controls">
          <button type="button" class="btn" id="predictBtn">Predict</button>
          <button type="button" class="btn ghost" id="clearBtn">Clear</button>
          <div class="spacer"></div>
          <div class="stats">
            <span id="charCount">0</span> chars ¬∑
            <span id="wordCount">0</span> words
          </div>
        </div>
      </form>

      <!-- Prediction Output -->
      <aside class="card glass output-card">
        <h2 class="output-header">Prediction</h2>

        <div id="predictionArea" class="prediction-area">
          Results will appear here.
        </div>
      </aside>

    </section>

    <footer class="footer">
      <small>Made with ‚ù§Ô∏è ¬∑ Author: Aryan K.</small>
    </footer>

  </main>

  <script>
    const userText = document.getElementById('userText');
    const predictionArea = document.getElementById('predictionArea');
    const charCount = document.getElementById('charCount');
    const wordCount = document.getElementById('wordCount');

    function countWords(text) {
      return text.trim().split(/\s+/).filter(Boolean).length;
    }

    function updateStats() {
      const t = userText.value;
      charCount.textContent = t.length;
      wordCount.textContent = countWords(t);
    }

    userText.addEventListener("input", updateStats);
    updateStats();


    // üî• REAL Prediction API call to FastAPI
    async function analyzeText() {
      const text = userText.value.trim();
      if (!text) {
        predictionArea.textContent = "Please enter some text.";
        return;
      }

      predictionArea.textContent = "Analyzing...";

      try {
        const response = await fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        });

        const output = await response.json();

        if (output.error) {
          predictionArea.textContent = "Error: " + output.error;
          return;
        }

        let html = "<ul class='pred-list'>";
        for (const [label, score] of Object.entries(output)) {
          html += `<li><strong>${label}</strong>: ${score.toFixed(4)}</li>`;
        }
        html += "</ul>";

        predictionArea.innerHTML = html;

      } catch (err) {
        predictionArea.textContent = "An error occurred. Please try again.";
      }
    }

    document.getElementById("predictBtn").onclick = analyzeText;

    document.getElementById("clearBtn").onclick = () => {
      userText.value = "";
      predictionArea.textContent = "Results will appear here.";
      updateStats();
    };
  </script>

</body>
</html>
